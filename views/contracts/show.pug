extends ../layout

block content
	.row.justify-content-md-center
		h6.display-heading Contract Address:
			a(href=`https://rinkeby.etherscan.io/address/${contract.address}`)= contract.address
	.row
		.col-md-3
			.card.my-2
				.card-body
					h4.card-title Constructor
					ul.list-group.list-group-flush
						each method in init
							li.list-group-item
								a.sc-constructor(href="#")= method.type
			.card.my-2
				.card-body
					h4.card-title Functions
					ul.list-group.list-group-flush
						each method in methods
							li.list-group-item
								a.sc-action(href="#")= method.name
			.card.my-2
				.card-body
					h4.card-title Variables
					ul.list-group.list-group-flush
						each variable in variables
							li.list-group-item
								a.sc-variable(href="#")= variable.name
			.card.my-2
				.card-body
					h4.card-title Events
					ul.list-group.list-group-flush
						each event in events
							li.list-group-item
								a.sc-event(href="#")= event.name
		.col-md-9
			#input-form.card.my-2
			#transaction-hash.card.my-2
			#transaction-details.card.my-2
			#event-details
			#output.card.my-2

	script#transaction-hash-template(type='text/html').
		<div class="card-body" id="transaction-hash-container">
			<h3 class="card-title">Transaction Hash </h3>
			<hr>
			<a target="_blank" href="https://rinkeby.etherscan.io/tx/<%- hash %>"><%- hash %></a>
		</div>

	script#transaction-details-template(type='text/html').
		<div id="transaction-container" class="card-body">
			<h3 class="card-title">Transaction Details</h3>
			<hr>
			<table class="table table-bordered">
				<tbody>
					<tr>
						<th scope="row">Status</th>
						<td><%- receipt.status %></td>
					</tr>
					<tr>
						<th scope="row">Transaction Hash</th>
						<td><%- receipt.transactionHash %></td>
					</tr>
					<tr>
						<th scope="row">From</th>
						<td><%- receipt.from %></td>
					</tr>
					<tr>
						<th scope="row">To</th>
						<td><%- receipt.to %></td>
					</tr>
					<tr>
						<th scope="row">Gas</th>
						<td><%- receipt.gasUsed %></td>
					</tr>
					<tr>
						<th scope="row">Transaction Cost</th>
						<td><%- receipt.cumulativeGasUsed %></td>
					</tr>
					<tr>
						<th scope="row">Input</th>
						<td><%- inputData %></td>
					</tr>
					<tr>
						<th scope="row" colspan="1">Value</th>
						<td>0</td>
					</tr>
				</tbody>
			</table>
		</div>

	script#output-template(type='text/html').
		<div class="card-body">
			<h5 class="card-title">Output</h5>
			<div class="form-group">
				<input class="form-control" value="<%- result %>" disabled>
			</div>
		</div>

	script#inputlist(type='text/html').
		<div class="card-body">
			<h3 class="card-title"><%- action %></h3>
			<hr>
			<form id="input-params" method="POST">
				<% if (inputs.length > 0 && typeof(inputs) !== "undefined") { %>
					<h5 class="card-title">Input</h5>
					<% _.forEach(inputs, function(input) { %>
						<div class="form-group">
							<label for="<%- input.name %>"><%- input.name %> (<%- input.type %>)</label>
							<input class="form-control" name="<%- input.name %>">
						</div>
					<% }); %>
				<% } %>
				<% if (payable) { %>
					<h5 class="card-title">Send Ether (Payable)</h5>
					<div class="form-group">
						<label for="ether">Ethereum</label>
						<input class="form-control" name="ethereum">
					</div>
				<% } %>
				<button type="submit" class="btn btn-primary send-transaction" rel="<%- action %>">Transact</button>
			</form>
		</div>

	script#event-list-template(type='text/html').
		<h3>Events</h3>
		<% _.forEach(events, function(eventDetails) { %>
			<table class="table table-bordered">
				<thead>
					<tr>
						<th scope="col" colspan="2"><%- eventDetails.name %></th>
					</tr>
				</thead>
				<tbody>
				<% _.forEach(eventDetails.events, function(eventItem) { %>
					<tr>
						<th scope="row"><%- eventItem.name %> (<%- eventItem.type %>)</th>
						<td><%- eventItem.value %></td>
					</tr>
				<% }); %>
				</tbody>
			</table>
		<% }); %>

	script#past-events-template(type='text/html').
		<h3>Past Events - <%- eventName %></h3>
		<% _.forEach(events, function(eventDetails) { %>
			<div class="card my-3">
				<div class="card-body">
					<p class="card-text"> <strong>Transaction Hash: </strong>
						<a href="https://rinkeby.etherscan.io/tx/<%- eventDetails.transactionHash %>"><%- eventDetails.transactionHash %></a>
					</p>
					<p class="card-title"><strong>Params</strong></p>
					<pre><code class="language-javascript"><%- JSON.stringify(eventDetails.returnValues) %></code></pre>
				</div>
			</div>
		<% }); %>
		
	script(type='text/javascript').
		const contractAbi = JSON.parse(!{JSON.stringify(contract.abi)})
		const contractAddress = "#{contract.address}"